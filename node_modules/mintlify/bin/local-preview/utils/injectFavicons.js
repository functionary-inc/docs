import favicons from "favicons";
import { promises as _promises } from "fs";
import { outputFile } from "fs-extra";
import { join } from "path";
import { CLIENT_PATH, CMD_EXEC_PATH } from "../../constants.js";
const { readFile } = _promises;
export const injectFavicons = async (configObj, logger) => {
    if ((configObj === null || configObj === void 0 ? void 0 : configObj.favicon) == null)
        return;
    const desiredPath = join(CMD_EXEC_PATH, configObj.favicon);
    const favicon = await readFile(desiredPath);
    if (favicon == null)
        return;
    logger.start("Generating favicons...");
    const promises = [];
    try {
        const response = await favicons(favicon, faviconConfig(configObj === null || configObj === void 0 ? void 0 : configObj.name));
        response.images.forEach((img) => {
            promises.push((async () => {
                const targetPath = join(CLIENT_PATH, "public", "favicons", img.name);
                await outputFile(targetPath, Buffer.from(img.contents), {
                    flag: "w",
                });
            })());
        });
        response.files.forEach((file) => {
            promises.push((async () => {
                const targetPath = join(CLIENT_PATH, "public", "favicons", file.name);
                await outputFile(targetPath, file.contents, { flag: "w" });
            })());
        });
        await Promise.all(promises);
        logger.succeed("Favicons generated");
    }
    catch (err) {
        console.log(err.message); // Error description e.g. "An unknown error has occurred"
    }
};
const faviconConfig = (name) => ({
    path: "/favicons",
    appName: name,
    appShortName: name,
    appDescription: null,
    developerName: null,
    developerURL: null,
    dir: "auto",
    lang: "en-US",
    background: "#fff",
    theme_color: "#fff",
    appleStatusBarStyle: "black-translucent",
    display: "standalone",
    orientation: "any",
    scope: "/",
    start_url: "/?homescreen=1",
    preferRelatedApplications: false,
    relatedApplications: undefined,
    version: "1.0",
    logging: false,
    pixel_art: false,
    loadManifestWithCredentials: true,
    manifestMaskable: false,
    icons: {
        android: ["android-chrome-192x192.png", "android-chrome-256x256.png"],
        appleIcon: ["apple-touch-icon.png"],
        appleStartup: false,
        favicons: true,
        windows: ["mstile-150x150.png"],
        yandex: false,
        firefox: false,
    },
});
//# sourceMappingURL=injectFavicons.js.map